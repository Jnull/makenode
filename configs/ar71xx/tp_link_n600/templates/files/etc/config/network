
config switch
  option name 'switch0'
  option reset '1'
  option enable_vlan '1'
      
# Note: LAN ports (as written on the back of the router)
#       and switch ports are reversed, such that 
#       LAN port 1 is switch port 4      

# lan port 1 (switch port 4)
# is on vlan 1 (eth0.1) tagged
config switch_vlan
  option device 'switch0'
  option vlan '1'
  option ports '0t 4t'

# lan port 2 (switch port 3)
# is on vlan 2 (eth0.3) tagged
config switch_vlan
  option device 'switch0'
  option vlan '2'
  option ports '0t 3t'

# lan ports 3 and 4 (switch ports 1 and 2)
# are both on vlan 5 (eth0.5) untagged
# and lan ports 1 and 2 are on vlan 5 tagged
config switch_vlan
  option device 'switch0'
  option vlan '5'

  # port 0 is the internal CPU port
  # and 't' denotes that it is vlan tagged
  # http://wiki.openwrt.org/doc/uci/network/switch
  option ports '0t 3t 4t 1 2'

config interface 'loopback'
  option ifname 'lo'
  option proto 'static'
  option ipaddr '127.0.0.1'
  option netmask '255.0.0.0'

config interface 'wan'
  option ifname 'eth1'
  option proto 'dhcp'

# This is for development only
# TODO We should remove the static IP before beta launch
config interface 'wan2' 
  option ifname 'eth1'
  option proto 'static'
  option ipaddr '172.22.0.1'
  option netmask '255.255.255.0'

config interface 'wan6'
  option ifname '@wan'
  option proto 'dhcpv6'

config interface 'antenna1'
  option ifname 'eth0.3'
  option proto 'static'
  option ipaddr '<%= adhoc_addr_ipv4 %>'
  option dns '<%= exit_node_mesh_ipv4_addr %>'
  option netmask '<%= adhoc_subnet_ipv4_bitmask %>'

config interface 'antenna2'
  option ifname 'eth0.4'
  option proto 'static'
  option ipaddr '<%= adhoc_addr_ipv4 %>'
  option dns '<%= exit_node_mesh_ipv4_addr %>'
  option netmask '<%= adhoc_subnet_ipv4_bitmask %>'

config interface 'adhoc'
  option ifname 'adhoc0'
  option proto 'static'
  option ipaddr '<%= adhoc_addr_ipv4 %>'
  option dns '<%= exit_node_mesh_ipv4_addr %>'
  option netmask '<%= adhoc_subnet_ipv4_mask %>'

# This will be our "peoplesopen.net" bridge
config interface 'open'
  option type 'bridge'
  option ifname 'open0 eth0.5'
  option proto 'static'
  option ipaddr '<%= open_addr_ipv4 %>'
  option dns '<%= exit_node_mesh_ipv4_addr %>'
  option netmask '<%= open_subnet_ipv4_mask %>'
       
config interface 'priv'
  option ifname 'priv0'
  option proto 'static'
  option ipaddr '172.30.0.1'
  option netmask '255.255.0.0'
